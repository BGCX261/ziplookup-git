/*
 * $.zipLookup v0.1
 *   - by Ari Asulin (ari.asulin at gmail.com)
 *   - jQuery plugin to dynamically fill in City/State Form Fields using an ajax Zipcode lookup
 *   - Apache License, Version 2.0
 *
 */
(function(){var e=2;var t="zip-lookup-field-zipcode";var n="zip-lookup-field-city";var r="zip-lookup-field-state";var i="zip-lookup-field-state-short";var s="zip-lookup-message";var o=function(e,t){if(e.nodeName.toLowerCase()==="select"){var n=e.getElementsByTagName("option");for(var r=0;r<n.length;r++){if(n[r].value===t||n[r].innerHTML===t){e.selectedIndex=r;return}}}if(e.nodeName.toLowerCase()==="input"){e.setAttribute("value",t)}else{e.setAttribute("data-value",t)}};var u=function(e,t){return(new RegExp("(^|\\s)"+t+"(\\s|$)","i")).test(e.className)};var a=function(e,t){if(!u(e,t))e.className+=(e.className?" ":"")+t};var f=function(e,t){if(u(e,t))e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(\\s|$)","i"),"")};var l=function(e,t){var n;if(document.createEvent){n=document.createEvent("HTMLEvents");n.initEvent(t,true,true)}else{n=document.createEventObject()}n.eventName=t;if(document.createEvent){e.dispatchEvent(n)}else{e.fireEvent("on"+t,n)}return n};var c=function(e,t){for(var n=0;n<e.children.length;n++){var r=e.children[n];if(t)if(t(r)===true)return false;if(c(r,t)===false)return false}return true};var h=function(t,n){var r=this;this.country=n||"us";var i=document.getElementsByTagName("head")[0];var s="zip-lookup/db";c(document,function(e){if(e.nodeName.toUpperCase()==="SCRIPT"){if(e.getAttribute("src")&&e.getAttribute("src").match(/zip-lookup(?:\.min)?\.js$/i)){s=e.getAttribute("src").replace(/zip-lookup(?:\.min)?\.js$/i,"db");i=e.parentNode;return true}}});var o=function(e,t,n){};this.onSuccess=function(e){o=e;return r};var u=function(e){};this.onError=function(e){u=e;return r};var a=t.substring(0,e);var f=t.substring(e);var l=s+"/"+this.country+"/"+a+".js";var h=document.createElement("script");h.src=l;h.type="text/javascript";h.async=true;i.appendChild(h);var p=setTimeout(function(){u("Search Timed out")},3e3);window["__zl"]=function(e){clearTimeout(p);if(e===undefined||e[0]===undefined)return u("Zipcode Not Found in DB");var t=e[0][f];if(e[1][t]===undefined)return u("Zipcode City Not Found in DB");var n=e[1][t].split("|");var r=n[0];if(!n[1])n[1]=0;var i=n[1];var s=e[2][i].split("|");var a=s[1];var l=s[0];o(r,a,l)};return this};var p=null;var d=function(e){switch(e.type){case"blur":case"change":if(u(e.target,t)){var d=e.target.value;if(d&&d!==p){p=d;l(e.target,"zip-lookup")}}break;case"zip-lookup":var v=e.target?e.target.value:null;c(e.target.form||document,function(e){if(u(e,s)){e.innerHTML="Searching...";f(e,"error")}});h(v).onError(function(t){c(e.target.form||document,function(e){if(u(e,s)){e.innerHTML=t;a(e,"error")}});e.target.setAttribute("zip-lookup-error-message",t);l(e.target,"zip-lookup-error")}).onSuccess(function(t,a,h){c(e.target.form||document,function(e){if(u(e,n))o(e,t);if(u(e,r)){o(e,a)}if(u(e,i))o(e,h);if(u(e,s)){e.innerHTML="Result found - "+t+", "+h;f(e,"error")}});e.target.setAttribute("data-city-name",t);e.target.setAttribute("data-state-name",a);e.target.setAttribute("data-state-short-name",h);l(e.target,"zip-lookup-found")});break;default:break}};document.addEventListener("blur",d);document.addEventListener("change",d);document.addEventListener("zip-lookup",d)})()